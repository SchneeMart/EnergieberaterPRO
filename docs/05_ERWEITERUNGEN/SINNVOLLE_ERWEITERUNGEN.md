# Sinnvolle Erweiterungen fÃ¼r EnergieberaterPRO

## Ãœbersicht der geplanten Erweiterungen

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ERWEITERUNGS-ROADMAP                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                  â”‚
â”‚  PHASE 1: KERN-FUNKTIONEN (MVP)                                                 â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                 â”‚
â”‚  âœ“ Energieausweis DE (Bedarfsausweis)                                           â”‚
â”‚  âœ“ Heizlastberechnung                                                           â”‚
â”‚  âœ“ U-Wert-Berechnung                                                            â”‚
â”‚  âœ“ Grundlegende Kundenverwaltung                                                â”‚
â”‚                                                                                  â”‚
â”‚  PHASE 2: ERWEITERTE PRODUKTE                                                   â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                   â”‚
â”‚  â–¡ iSFP (individueller Sanierungsfahrplan)                                      â”‚
â”‚  â–¡ Energieausweis AT (Ã–NORM)                                                    â”‚
â”‚  â–¡ Energieaudit DIN EN 16247                                                    â”‚
â”‚  â–¡ Verbrauchsausweis                                                            â”‚
â”‚                                                                                  â”‚
â”‚  PHASE 3: PREMIUM-FEATURES                                                      â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                      â”‚
â”‚  â–¡ KI-Assistent                                                                 â”‚
â”‚  â–¡ Automatische Dokumentenerkennung (OCR)                                       â”‚
â”‚  â–¡ FÃ¶rderungsoptimierung                                                        â”‚
â”‚  â–¡ Thermografie-Integration                                                     â”‚
â”‚                                                                                  â”‚
â”‚  PHASE 4: INTEGRATION & AUTOMATISIERUNG                                         â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                        â”‚
â”‚  â–¡ CAD-Import (DXF, IFC)                                                        â”‚
â”‚  â–¡ BIM-Integration                                                              â”‚
â”‚  â–¡ Schnittstelle zu BauÃ¤mtern                                                   â”‚
â”‚  â–¡ Automatische BAFA-Meldung                                                    â”‚
â”‚                                                                                  â”‚
â”‚  PHASE 5: MARKTPLATZ & Ã–KOSYSTEM                                                â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                               â”‚
â”‚  â–¡ Handwerker-Marktplatz                                                        â”‚
â”‚  â–¡ Produkt-Datenbank der Hersteller                                             â”‚
â”‚  â–¡ Finanzierungs-Partner                                                        â”‚
â”‚  â–¡ White-Label-LÃ¶sung                                                           â”‚
â”‚                                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 1. KI-Assistent

### Funktionsbeschreibung

Der KI-Assistent unterstÃ¼tzt Energieberater bei der tÃ¤glichen Arbeit durch intelligente Analyse und Empfehlungen.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           KI-ASSISTENT FEATURES                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                  â”‚
â”‚  1. AUTOMATISCHE DATENEXTRAKTION                                                â”‚
â”‚     â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                                                 â”‚
â”‚     â€¢ Fotos â†’ Bauteil-Erkennung (Fenster, Heizung, etc.)                        â”‚
â”‚     â€¢ PlÃ¤ne â†’ FlÃ¤chen- und MaÃŸextraktion                                        â”‚
â”‚     â€¢ Rechnungen â†’ Verbrauchsdaten-Extraktion                                   â”‚
â”‚     â€¢ Protokolle â†’ Anlagendaten-Ãœbernahme                                       â”‚
â”‚                                                                                  â”‚
â”‚  2. INTELLIGENTE EMPFEHLUNGEN                                                   â”‚
â”‚     â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                                                   â”‚
â”‚     â€¢ Optimale Sanierungsreihenfolge                                            â”‚
â”‚     â€¢ Wirtschaftlichste MaÃŸnahmen                                               â”‚
â”‚     â€¢ FÃ¶rdermittel-Optimierung                                                  â”‚
â”‚     â€¢ WÃ¤rmebrÃ¼cken-Erkennung in Fotos                                           â”‚
â”‚                                                                                  â”‚
â”‚  3. CHAT-INTERFACE                                                              â”‚
â”‚     â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                                                             â”‚
â”‚     â€¢ Normen-Fragen beantworten                                                 â”‚
â”‚     â€¢ Berechnungen erklÃ¤ren                                                     â”‚
â”‚     â€¢ Dokumentation automatisch erstellen                                       â”‚
â”‚     â€¢ Kundenanfragen vorbereiten                                                â”‚
â”‚                                                                                  â”‚
â”‚  4. QUALITÃ„TSSICHERUNG                                                          â”‚
â”‚     â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                                                          â”‚
â”‚     â€¢ PlausibilitÃ¤tsprÃ¼fung aller Eingaben                                      â”‚
â”‚     â€¢ Vergleich mit Ã¤hnlichen Projekten                                         â”‚
â”‚     â€¢ Fehler-Erkennung vor Export                                               â”‚
â”‚                                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Technische Umsetzung

```typescript
interface KIAssistentKonfiguration {
  // MCP-Server Integration
  mcp_server: {
    name: 'energieberater-ki';
    tools: MCPTool[];
    resources: MCPResource[];
  };

  // Modelle
  modelle: {
    chat: 'claude-3-5-sonnet';           // FÃ¼r Chat und Empfehlungen
    vision: 'claude-3-5-sonnet';         // FÃ¼r Bild-Analyse
    extraction: 'claude-3-5-haiku';      // FÃ¼r schnelle Extraktion
  };

  // Kontext-Fenster
  kontext: {
    max_tokens: 200000;
    projekt_kontext: boolean;            // Aktuelles Projekt mitgeben
    normen_kontext: boolean;             // Relevante Normen einbetten
    historie_tage: 30;                   // Projekt-Historie
  };
}

// MCP Tools fÃ¼r den Energieberater-Assistenten
const MCP_TOOLS: MCPTool[] = [
  {
    name: 'berechne_u_wert',
    description: 'Berechnet den U-Wert eines Bauteils basierend auf Schichtaufbau',
    input_schema: {
      type: 'object',
      properties: {
        schichten: {
          type: 'array',
          items: {
            type: 'object',
            properties: {
              material: { type: 'string' },
              dicke_mm: { type: 'number' }
            }
          }
        }
      },
      required: ['schichten']
    }
  },
  {
    name: 'suche_foerderung',
    description: 'Sucht passende FÃ¶rderprogramme fÃ¼r eine MaÃŸnahme',
    input_schema: {
      type: 'object',
      properties: {
        massnahme_typ: { type: 'string' },
        bundesland: { type: 'string' },
        gebaeude_typ: { type: 'string' }
      },
      required: ['massnahme_typ']
    }
  },
  {
    name: 'schaetze_kosten',
    description: 'SchÃ¤tzt Kosten fÃ¼r eine SanierungsmaÃŸnahme',
    input_schema: {
      type: 'object',
      properties: {
        massnahme_typ: { type: 'string' },
        flaeche_m2: { type: 'number' },
        qualitaet: { type: 'string', enum: ['standard', 'premium'] }
      },
      required: ['massnahme_typ', 'flaeche_m2']
    }
  },
  {
    name: 'analysiere_foto',
    description: 'Analysiert ein Foto und extrahiert relevante GebÃ¤udedaten',
    input_schema: {
      type: 'object',
      properties: {
        foto_base64: { type: 'string' },
        fokus: {
          type: 'string',
          enum: ['fassade', 'fenster', 'dach', 'heizung', 'thermografie']
        }
      },
      required: ['foto_base64']
    }
  }
];
```

### Beispiel-Interaktionen

```markdown
## Beispiel 1: Bauteil-Identifikation

**Nutzer lÃ¤dt Foto hoch**

**KI-Assistent:**
"Ich habe das Foto analysiert und folgende Bauteile erkannt:

1. **Fenster** (5 StÃ¼ck sichtbar)
   - GeschÃ¤tztes Alter: 1995-2005 (Isolierglas, Kunststoffrahmen)
   - GeschÃ¤tzter U-Wert: 1.6-2.0 W/(mÂ²Â·K)
   - Zustand: MÃ¤ÃŸig (Dichtungen sollten geprÃ¼ft werden)

2. **Fassade**
   - Typ: Verputztes Mauerwerk ohne DÃ¤mmung
   - GeschÃ¤tzte WandstÃ¤rke: 36cm
   - GeschÃ¤tzter U-Wert: 1.2-1.5 W/(mÂ²Â·K)

Soll ich diese Werte in das Projekt Ã¼bernehmen?"

---

## Beispiel 2: FÃ¶rder-Optimierung

**Nutzer:** "Welche FÃ¶rderung bekomme ich fÃ¼r eine WÃ¤rmepumpe?"

**KI-Assistent:**
"Basierend auf den Projektdaten (EFH, Baujahr 1978, Gasheizung):

**BAFA-FÃ¶rderung fÃ¼r WÃ¤rmepumpe:**
- Basis-FÃ¶rderung: 30% (max. 30.000â‚¬)
- Effizienz-Bonus: +5% (natÃ¼rliches KÃ¤ltemittel)
- Heizungs-Tausch-Bonus: +20% (Austausch Gas/Ã–l)
- **Gesamt: 55%** der fÃ¶rderfÃ¤higen Kosten

**GeschÃ¤tzte Kosten und FÃ¶rderung:**
- Luft-Wasser-WP inkl. Installation: ca. 28.000â‚¬
- FÃ¶rderung (55%): ca. 15.400â‚¬
- **Eigenanteil: ca. 12.600â‚¬**

âš ï¸ **Hinweis:** Die FÃ¶rderung muss VOR Auftragsvergabe beantragt werden!

Soll ich die FÃ¶rderdetails in die Wirtschaftlichkeitsberechnung Ã¼bernehmen?"
```

### Kosten-Modell fÃ¼r KI-Modul

```typescript
interface KIModulPreise {
  // Als Zusatzmodul fÃ¼r Organisationen
  basis: {
    name: 'KI-Assistent Basis';
    preis_monat: 29;
    features: [
      'Chat-Assistent fÃ¼r Fragen',
      '50 Foto-Analysen/Monat',
      'FÃ¶rder-Empfehlungen'
    ];
  };

  pro: {
    name: 'KI-Assistent Pro';
    preis_monat: 79;
    features: [
      'Alles aus Basis',
      'Unbegrenzte Foto-Analysen',
      'Automatische Datenextraktion',
      'OCR fÃ¼r Dokumente',
      'Individuelle Trainings'
    ];
  };

  // Token-basierte Abrechnung als Alternative
  pay_per_use: {
    chat_pro_token: 0.00002;
    bild_analyse: 0.10;
    dokument_extraktion: 0.25;
  };
}
```

---

## 2. Automatische Dokumentenerkennung (OCR)

### UnterstÃ¼tzte Dokumenttypen

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        DOKUMENT-ERKENNUNG                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                  â”‚
â”‚  RECHNUNGEN & ABRECHNUNGEN                                                      â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                      â”‚
â”‚  â€¢ Heizkostenabrechnung â†’ Verbrauchsdaten                                       â”‚
â”‚  â€¢ Stromrechnung â†’ Stromverbrauch, PV-Einspeisung                               â”‚
â”‚  â€¢ Gasrechnung â†’ Gasverbrauch in kWh                                            â”‚
â”‚  â€¢ Ã–llieferung â†’ Ã–lverbrauch in Litern                                          â”‚
â”‚                                                                                  â”‚
â”‚  TECHNISCHE DOKUMENTE                                                           â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                           â”‚
â”‚  â€¢ Schornsteinfeger-Protokoll â†’ Kesseltyp, Wirkungsgrad                         â”‚
â”‚  â€¢ Wartungsprotokolle â†’ Anlagendaten                                            â”‚
â”‚  â€¢ Heizlast-Berechnungen â†’ Vorhandene Werte                                     â”‚
â”‚  â€¢ Energieausweise (alt) â†’ Vergleichswerte                                      â”‚
â”‚                                                                                  â”‚
â”‚  BAUPLÃ„NE & ZEICHNUNGEN                                                         â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                        â”‚
â”‚  â€¢ Grundrisse â†’ RaumflÃ¤chen, MaÃŸe                                               â”‚
â”‚  â€¢ Schnitte â†’ GeschosshÃ¶hen                                                     â”‚
â”‚  â€¢ Ansichten â†’ FensterflÃ¤chen, Proportionen                                     â”‚
â”‚                                                                                  â”‚
â”‚  PRODUKTDATENBLÃ„TTER                                                            â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                           â”‚
â”‚  â€¢ Fenster-Zertifikate â†’ U_w, g-Wert                                            â”‚
â”‚  â€¢ DÃ¤mmstoffe â†’ Lambda, Dicke                                                   â”‚
â”‚  â€¢ HeizgerÃ¤te â†’ Leistung, Wirkungsgrad                                          â”‚
â”‚                                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Technische Umsetzung

```typescript
interface OCRPipeline {
  // Schritt 1: Dokumenten-Klassifikation
  klassifikation: {
    modell: 'document-classifier';
    klassen: [
      'heizkostenabrechnung',
      'stromrechnung',
      'gasrechnung',
      'schornsteinfeger',
      'energieausweis',
      'grundriss',
      'datenblatt',
      'unbekannt'
    ];
  };

  // Schritt 2: Layout-Erkennung
  layout: {
    modell: 'layout-parser';
    features: ['tabellen', 'listen', 'formulare', 'diagramme'];
  };

  // Schritt 3: Text-Extraktion
  ocr: {
    engine: 'tesseract' | 'google-vision' | 'azure-ocr';
    sprachen: ['de', 'en'];
    konfidenz_schwelle: 0.85;
  };

  // Schritt 4: Strukturierte Extraktion
  extraktion: {
    modell: 'claude-3-5-haiku';
    schema_pro_dokumenttyp: Record<string, JSONSchema>;
  };
}

// Beispiel: Heizkostenabrechnung-Schema
const HEIZKOSTENABRECHNUNG_SCHEMA: JSONSchema = {
  type: 'object',
  properties: {
    abrechnungszeitraum: {
      type: 'object',
      properties: {
        von: { type: 'string', format: 'date' },
        bis: { type: 'string', format: 'date' }
      }
    },
    gesamtverbrauch: {
      type: 'object',
      properties: {
        heizung_kwh: { type: 'number' },
        warmwasser_kwh: { type: 'number' },
        gesamt_kwh: { type: 'number' }
      }
    },
    einheiten: {
      type: 'object',
      properties: {
        heizung_einheiten: { type: 'number' },
        warmwasser_m3: { type: 'number' }
      }
    },
    kosten: {
      type: 'object',
      properties: {
        heizung_euro: { type: 'number' },
        warmwasser_euro: { type: 'number' },
        gesamt_euro: { type: 'number' }
      }
    },
    energietraeger: {
      type: 'string',
      enum: ['erdgas', 'heizoel', 'fernwaerme', 'strom', 'pellets']
    },
    wohnflaeche_m2: { type: 'number' }
  }
};

// Verarbeitungs-Workflow
async function verarbeiteHochgeladenesDokument(
  file: File,
  projektId: string
): Promise<DokumentVerarbeitungsErgebnis> {
  // 1. Klassifizieren
  const klasse = await klassifiziereDokument(file);

  // 2. OCR durchfÃ¼hren
  const text = await extrahiereText(file);

  // 3. Strukturiert extrahieren
  const schema = SCHEMAS_PRO_KLASSE[klasse];
  const daten = await extrahiereStrukturiert(text, schema);

  // 4. Validieren
  const validierung = await validiereDaten(daten, klasse);

  // 5. In Projekt Ã¼bernehmen (mit BestÃ¤tigung)
  return {
    dokument_typ: klasse,
    extrahierte_daten: daten,
    konfidenz: validierung.konfidenz,
    vorschau: erstelleVorschau(daten),
    aktionen: [
      {
        label: 'In Projekt Ã¼bernehmen',
        action: () => uebernehmeDaten(projektId, daten)
      },
      {
        label: 'Manuell bearbeiten',
        action: () => oeffneEditor(daten)
      }
    ]
  };
}
```

---

## 3. FÃ¶rderungsoptimierung

### FÃ¶rderdatenbank

```typescript
interface Foerderprogramm {
  id: string;
  name: string;
  geber: 'bafa' | 'kfw' | 'land' | 'kommune';
  bundesland?: string;
  zielgruppe: ('privat' | 'gewerbe' | 'kommunen')[];
  massnahmen: MassnahmenTyp[];
  foerderart: 'zuschuss' | 'kredit' | 'tilgungszuschuss';
  foerdersatz: {
    basis_prozent: number;
    max_betrag?: number;
    min_betrag?: number;
    boni?: {
      name: string;
      prozent: number;
      bedingung: string;
    }[];
  };
  anforderungen: {
    technisch: string[];
    formell: string[];
    fristen: {
      antrag_vor_beginn: boolean;
      verwendungsnachweis_monate: number;
    };
  };
  kombinierbar: string[];           // IDs kombinierbarer Programme
  nicht_kombinierbar: string[];
  gueltig_von: string;
  gueltig_bis?: string;
  link: string;
}

// Beispiel: BAFA HeizungsfÃ¶rderung 2024
const BAFA_HEIZUNG_2024: Foerderprogramm = {
  id: 'bafa-heizung-2024',
  name: 'BundesfÃ¶rderung fÃ¼r effiziente GebÃ¤ude - EinzelmaÃŸnahmen (BEG EM)',
  geber: 'bafa',
  zielgruppe: ['privat', 'gewerbe'],
  massnahmen: ['waermepumpe', 'solarthermie', 'biomasseheizung', 'brennstoffzelle'],
  foerderart: 'zuschuss',
  foerdersatz: {
    basis_prozent: 30,
    max_betrag: 30000,
    boni: [
      {
        name: 'Effizienz-Bonus',
        prozent: 5,
        bedingung: 'WÃ¤rmepumpe mit natÃ¼rlichem KÃ¤ltemittel oder ErdwÃ¤rme/Wasser'
      },
      {
        name: 'Klimageschwindigkeits-Bonus',
        prozent: 20,
        bedingung: 'Austausch funktionierende Gas/Ã–l/Kohle/Nachtspeicher-Heizung'
      },
      {
        name: 'Einkommens-Bonus',
        prozent: 30,
        bedingung: 'Haushaltseinkommen unter 40.000â‚¬/Jahr'
      }
    ]
  },
  anforderungen: {
    technisch: [
      'WÃ¤rmepumpe: JAZ â‰¥ 3.0',
      'Biomasse: Î·_N â‰¥ 0.81 (Scheitholz) / 0.86 (Pellets)',
      'Einbau durch Fachunternehmen',
      'Hydraulischer Abgleich Verfahren B'
    ],
    formell: [
      'Registrierung auf BAFA-Portal',
      'Liegenschaftsnachweis',
      'KostenvoranschlÃ¤ge'
    ],
    fristen: {
      antrag_vor_beginn: true,
      verwendungsnachweis_monate: 36
    }
  },
  kombinierbar: ['kfw-261', 'kfw-262'],
  nicht_kombinierbar: ['bafa-heizung-alt'],
  gueltig_von: '2024-01-01',
  link: 'https://www.bafa.de/beg-em'
};
```

### Optimierungs-Algorithmus

```typescript
interface FoerderOptimierung {
  massnahmen: Massnahme[];
  kunde: {
    typ: 'privat' | 'gewerbe';
    bundesland: string;
    einkommen_unter_40k?: boolean;
    wohneigentum: boolean;
  };
  gebaeude: {
    baujahr: number;
    typ: string;
    aktuelle_heizung: string;
    denkmalschutz: boolean;
  };
}

interface OptimierungsErgebnis {
  varianten: FoerderVariante[];
  empfehlung: FoerderVariante;
  hinweise: string[];
}

interface FoerderVariante {
  name: string;
  programme: {
    programm: Foerderprogramm;
    massnahmen: string[];
    foerderbetrag: number;
    bedingungen_erfuellt: boolean;
    fehlende_bedingungen: string[];
  }[];
  gesamt_foerderung: number;
  gesamt_investition: number;
  eigenanteil: number;
  jaehrliche_einsparung: number;
  amortisation_jahre: number;
}

async function optimiereFoerderung(
  input: FoerderOptimierung
): Promise<OptimierungsErgebnis> {
  // 1. Passende Programme filtern
  const passendeProgramme = await filtereProgramme(
    input.massnahmen,
    input.kunde,
    input.gebaeude
  );

  // 2. Kombinationen generieren
  const kombinationen = generiereKombinationen(
    passendeProgramme,
    input.massnahmen
  );

  // 3. Jede Kombination bewerten
  const varianten: FoerderVariante[] = [];

  for (const kombi of kombinationen) {
    const variante = berechneVariante(kombi, input);
    if (variante.gesamt_foerderung > 0) {
      varianten.push(variante);
    }
  }

  // 4. Nach GesamtfÃ¶rderung sortieren
  varianten.sort((a, b) => b.gesamt_foerderung - a.gesamt_foerderung);

  // 5. Empfehlung ermitteln (beste Kombination aus FÃ¶rderung und KomplexitÃ¤t)
  const empfehlung = ermittleEmpfehlung(varianten);

  return {
    varianten: varianten.slice(0, 5),  // Top 5
    empfehlung,
    hinweise: generiereHinweise(empfehlung, input)
  };
}

function generiereHinweise(
  empfehlung: FoerderVariante,
  input: FoerderOptimierung
): string[] {
  const hinweise: string[] = [];

  // Einkommens-Bonus prÃ¼fen
  if (input.kunde.typ === 'privat' && input.kunde.einkommen_unter_40k === undefined) {
    hinweise.push(
      'ğŸ’¡ Bei Haushaltseinkommen unter 40.000â‚¬/Jahr ist ein zusÃ¤tzlicher Einkommens-Bonus von 30% mÃ¶glich.'
    );
  }

  // Klimabonus prÃ¼fen
  if (input.gebaeude.aktuelle_heizung.includes('gas') ||
      input.gebaeude.aktuelle_heizung.includes('Ã¶l')) {
    hinweise.push(
      'ğŸ’¡ Beim Austausch der bestehenden Gas-/Ã–lheizung erhalten Sie den Klimageschwindigkeits-Bonus (+20%).'
    );
  }

  // Denkmalschutz
  if (input.gebaeude.denkmalschutz) {
    hinweise.push(
      'âš ï¸ Bei Denkmalschutz kÃ¶nnen abweichende Anforderungen gelten. Abstimmung mit DenkmalbehÃ¶rde erforderlich.'
    );
  }

  // Frist-Hinweis
  hinweise.push(
    'âš ï¸ Wichtig: FÃ¶rderantrag muss VOR Auftragsvergabe gestellt werden!'
  );

  return hinweise;
}
```

---

## 4. Thermografie-Integration

### Funktionsbeschreibung

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        THERMOGRAFIE-MODUL                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                  â”‚
â”‚  BILDAUFNAHME                                                                   â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•                                                                    â”‚
â”‚  â€¢ Import von Thermografie-Kameras (FLIR, Testo, etc.)                          â”‚
â”‚  â€¢ Smartphone-Thermografie (FLIR One, Seek Thermal)                             â”‚
â”‚  â€¢ RAW-Format-UnterstÃ¼tzung fÃ¼r genaue Temperaturen                             â”‚
â”‚                                                                                  â”‚
â”‚  AUTOMATISCHE ANALYSE                                                           â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                           â”‚
â”‚  â€¢ WÃ¤rmebrÃ¼cken-Erkennung                                                       â”‚
â”‚  â€¢ Leckage-Identifikation                                                       â”‚
â”‚  â€¢ Fenster-QualitÃ¤t bewerten                                                    â”‚
â”‚  â€¢ Feuchtigkeit erkennen                                                        â”‚
â”‚                                                                                  â”‚
â”‚  DOKUMENTATION                                                                  â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•                                                                  â”‚
â”‚  â€¢ Automatische Beschriftung                                                    â”‚
â”‚  â€¢ Temperaturprofile                                                            â”‚
â”‚  â€¢ Vergleich IR / Sichtbild                                                     â”‚
â”‚  â€¢ Export fÃ¼r Gutachten                                                         â”‚
â”‚                                                                                  â”‚
â”‚  VERKNÃœPFUNG MIT BERECHNUNG                                                     â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                    â”‚
â”‚  â€¢ WÃ¤rmebrÃ¼ckenzuschlag aus Thermografie ableiten                               â”‚
â”‚  â€¢ QualitÃ¤tskontrolle der Eingaben                                              â”‚
â”‚  â€¢ Nachher-Dokumentation bei Sanierung                                          â”‚
â”‚                                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Technische Integration

```typescript
interface ThermografieAnalyse {
  bild: {
    id: string;
    typ: 'radiometrisch' | 'screenshot';
    aufnahme_datum: Date;
    aussentemperatur: number;
    innentemperatur: number;
    emissionsgrad: number;
    kamera_modell: string;
  };

  analyse: {
    min_temp: number;
    max_temp: number;
    avg_temp: number;
    hotspots: ThermoSpot[];
    coldspots: ThermoSpot[];
    waermebruecken: Waermebruecke[];
  };

  bewertung: {
    qualitaet: 'gut' | 'mittel' | 'schlecht';
    handlungsbedarf: boolean;
    empfehlungen: string[];
  };
}

interface ThermoSpot {
  x: number;              // Position im Bild (%)
  y: number;
  temperatur: number;
  flaeche_prozent: number;
  klassifikation: 'waermebruecke' | 'leckage' | 'feuchtigkeit' | 'normal';
}

async function analysiereThermografieBild(
  bild: ArrayBuffer,
  metadaten: ThermografieMetadaten
): Promise<ThermografieAnalyse> {
  // 1. Radiometrische Daten extrahieren (wenn vorhanden)
  const tempMatrix = await extrahiereTemperaturMatrix(bild);

  // 2. Bildanalyse mit KI
  const kiAnalyse = await analysiereThermoBild(bild, {
    kontext: 'gebaeude_fassade',
    fokus: ['waermebruecken', 'fenster', 'anschluesse']
  });

  // 3. Temperaturbereiche analysieren
  const statistik = berechneTemperaturStatistik(tempMatrix);

  // 4. AuffÃ¤lligkeiten identifizieren
  const spots = identifiziereSpots(tempMatrix, statistik);

  // 5. WÃ¤rmebrÃ¼cken klassifizieren
  const waermebruecken = klassifiziereWaermebruecken(
    spots.coldspots,
    kiAnalyse.erkannte_bauteile
  );

  // 6. Bewertung erstellen
  const bewertung = bewerteFassade(statistik, waermebruecken);

  return {
    bild: {
      id: generateId(),
      typ: tempMatrix ? 'radiometrisch' : 'screenshot',
      aufnahme_datum: new Date(),
      aussentemperatur: metadaten.theta_e,
      innentemperatur: metadaten.theta_i,
      emissionsgrad: metadaten.epsilon ?? 0.95,
      kamera_modell: metadaten.kamera
    },
    analyse: {
      ...statistik,
      hotspots: spots.hotspots,
      coldspots: spots.coldspots,
      waermebruecken
    },
    bewertung
  };
}
```

---

## 5. CAD-Import und BIM-Integration

### UnterstÃ¼tzte Formate

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        CAD/BIM INTEGRATION                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                  â”‚
â”‚  2D-FORMATE                                                                     â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•                                                                     â”‚
â”‚  â€¢ DXF/DWG â†’ AutoCAD, BricsCAD, etc.                                            â”‚
â”‚  â€¢ PDF â†’ PlÃ¤ne als PDF (mit MaÃŸstab)                                            â”‚
â”‚  â€¢ SVG â†’ Vektorgrafiken                                                         â”‚
â”‚                                                                                  â”‚
â”‚  3D-FORMATE                                                                     â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•                                                                     â”‚
â”‚  â€¢ IFC (Industry Foundation Classes) â†’ BIM-Standard                             â”‚
â”‚  â€¢ gbXML â†’ Energieanalyse-Format                                                â”‚
â”‚  â€¢ SketchUp â†’ .skp-Dateien                                                      â”‚
â”‚                                                                                  â”‚
â”‚  EXTRAHIERBARE DATEN                                                            â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                           â”‚
â”‚  â€¢ RaumflÃ¤chen und Volumina                                                     â”‚
â”‚  â€¢ BauteilflÃ¤chen nach Orientierung                                             â”‚
â”‚  â€¢ Fenster- und TÃ¼rpositionen                                                   â”‚
â”‚  â€¢ Schichtaufbauten (bei IFC)                                                   â”‚
â”‚  â€¢ Zonierung (bei gbXML)                                                        â”‚
â”‚                                                                                  â”‚
â”‚  EXPORT                                                                         â”‚
â”‚  â•â•â•â•â•â•                                                                         â”‚
â”‚  â€¢ IFC mit Energiedaten angereichert                                            â”‚
â”‚  â€¢ gbXML fÃ¼r Energiesimulation                                                  â”‚
â”‚  â€¢ PDF-Dokumentation mit 3D-Ansichten                                           â”‚
â”‚                                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### IFC-Import Workflow

```typescript
interface IFCImportErgebnis {
  projekt: {
    name: string;
    adresse: string;
    autor: string;
  };

  gebaeude: {
    stockwerke: IFCStockwerk[];
    A_BGF: number;
    V_brutto: number;
  };

  bauteile: IFCBauteil[];

  zonen: IFCZone[];

  warnungen: string[];
}

interface IFCBauteil {
  ifc_id: string;
  ifc_typ: string;                    // IfcWall, IfcWindow, etc.
  name: string;
  flaeche: number;
  orientierung?: Orientation;
  schichten?: IFCSchicht[];
  eigenschaften: Record<string, any>;
}

async function importiereIFC(
  datei: File
): Promise<IFCImportErgebnis> {
  // 1. IFC parsen
  const ifcModel = await parseIFC(datei);

  // 2. GebÃ¤ude-Hierarchie aufbauen
  const gebaeude = extrahiereGebaeudeStruktur(ifcModel);

  // 3. Bauteile extrahieren
  const bauteile = extrahiereBauteile(ifcModel);

  // 4. Thermische Eigenschaften wenn vorhanden
  for (const bauteil of bauteile) {
    const thermalProps = findeThermalProperties(ifcModel, bauteil.ifc_id);
    if (thermalProps) {
      bauteil.U_wert = thermalProps.U;
      bauteil.schichten = thermalProps.layers;
    }
  }

  // 5. FlÃ¤chen berechnen
  berechneFlaechen(gebaeude, bauteile);

  // 6. Mapping zu EnergieberaterPRO-Datenmodell
  return mappeZuProjekt(gebaeude, bauteile);
}
```

---

## 6. Handwerker-Marktplatz

### Konzept

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        HANDWERKER-MARKTPLATZ                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                  â”‚
â”‚  FÃœR ENERGIEBERATER                                                             â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                             â”‚
â”‚  â€¢ Qualifizierte Handwerker nach Gewerk finden                                  â”‚
â”‚  â€¢ Angebote direkt aus der Berechnung anfordern                                 â”‚
â”‚  â€¢ Bewertungen und Referenzen einsehen                                          â”‚
â”‚  â€¢ Koordination der Gewerke                                                     â”‚
â”‚                                                                                  â”‚
â”‚  FÃœR HANDWERKER                                                                 â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                                â”‚
â”‚  â€¢ Qualifizierte Anfragen erhalten                                              â”‚
â”‚  â€¢ Detaillierte Leistungsbeschreibung vorab                                     â”‚
â”‚  â€¢ Keine Kaltakquise nÃ¶tig                                                      â”‚
â”‚  â€¢ Eigene Referenzen prÃ¤sentieren                                               â”‚
â”‚                                                                                  â”‚
â”‚  GEWERKE                                                                        â”‚
â”‚  â•â•â•â•â•â•â•                                                                        â”‚
â”‚  â€¢ Heizung/SanitÃ¤r (WÃ¤rmepumpe, Solar, etc.)                                    â”‚
â”‚  â€¢ Dachdecker (DÃ¤mmung, PV-Montage)                                             â”‚
â”‚  â€¢ Fensterbau (Fensteraustausch)                                                â”‚
â”‚  â€¢ Maler/Fassade (WDVS, Putz)                                                   â”‚
â”‚  â€¢ Elektro (PV-Anschluss, Wallbox)                                              â”‚
â”‚  â€¢ Zimmerei (Dachausbau, Holzbau)                                               â”‚
â”‚                                                                                  â”‚
â”‚  GESCHÃ„FTSMODELL                                                                â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                                 â”‚
â”‚  â€¢ Handwerker: Provision bei vermitteltem Auftrag (3-5%)                        â”‚
â”‚  â€¢ Energieberater: Kostenlos                                                    â”‚
â”‚  â€¢ Premium-Listung fÃ¼r Handwerker (monatlich)                                   â”‚
â”‚                                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. Produkt-Datenbank der Hersteller

### Datenbank-Struktur

```typescript
interface ProduktDatenbank {
  kategorien: {
    fenster: FensterProdukt[];
    daemmstoffe: DaemmstoffProdukt[];
    heizsysteme: HeizsystemProdukt[];
    lueftung: LueftungsProdukt[];
    solarthermie: SolarthermieProdukt[];
    photovoltaik: PVProdukt[];
  };
}

interface FensterProdukt {
  id: string;
  hersteller: string;
  produktname: string;
  serie: string;

  // Technische Daten
  U_w: number;                        // W/(mÂ²Â·K)
  U_g: number;                        // Verglasung
  U_f: number;                        // Rahmen
  g_wert: number;
  psi_g: number;                      // Glasrandverbund
  rahmenanteil: number;

  // Optionen
  verglasung_optionen: {
    zweifach: { U_g: number; g: number };
    dreifach: { U_g: number; g: number };
  };

  rahmenmaterial: 'kunststoff' | 'holz' | 'alu' | 'holz_alu';

  // Zertifizierung
  ce_kennzeichnung: boolean;
  passivhaus_zertifikat?: 'phA' | 'phB' | 'phC';

  // Preise (Richtpreise)
  preis_ab: number;                   // â‚¬/mÂ²
  preis_bis: number;

  // Dokumentation
  datenblatt_url: string;
  einbauanleitung_url?: string;
}

interface DaemmstoffProdukt {
  id: string;
  hersteller: string;
  produktname: string;

  // Technische Daten
  lambda: number;                     // W/(mÂ·K)
  dicken_mm: number[];               // VerfÃ¼gbare Dicken
  roh_dichte: number;                // kg/mÂ³
  waermekapazitaet: number;          // J/(kgÂ·K)

  // Brandschutz
  brandklasse: 'A1' | 'A2' | 'B1' | 'B2' | 'C' | 'D' | 'E' | 'F';

  // Feuchteschutz
  diffusionswiderstand: number;      // Âµ-Wert
  wasseraufnahme: number;            // kg/mÂ²

  // Anwendung
  anwendungen: ('aussenwand' | 'innendaemmung' | 'dach' | 'kellerdecke' | 'perimeter')[];

  // Ã–kologie
  recycling_faehig: boolean;
  oekobilanz?: {
    gwp: number;                     // Global Warming Potential
    penrt: number;                   // Nicht-erneuerbare PrimÃ¤renergie
  };

  // Preise
  preis_pro_m2: Record<number, number>;  // Dicke â†’ â‚¬/mÂ²

  // Dokumentation
  datenblatt_url: string;
  epd_url?: string;                  // Environmental Product Declaration
}

interface HeizsystemProdukt {
  id: string;
  hersteller: string;
  produktname: string;
  typ: WaermeerzeugerTyp;

  // Leistung
  P_nenn_kW: number;
  P_min_kW?: number;                 // Modulationsbereich
  P_max_kW?: number;

  // Effizienz
  eta_s?: number;                    // Jahreszeitbedingte Raumheizungs-Energieeffizienz
  cop_a7w35?: number;                // WÃ¤rmepumpe: A7/W35
  cop_a2w35?: number;                // WÃ¤rmepumpe: A2/W35
  cop_b0w35?: number;                // Sole-WP: B0/W35
  scop?: number;                     // Seasonal COP
  eta_ww?: number;                   // Warmwasserbereitung

  // Schall
  schallleistung_db?: number;
  schallleistung_innen_db?: number;

  // KÃ¤ltemittel (WÃ¤rmepumpen)
  kaeltemittel?: string;
  gwp_kaeltemittel?: number;

  // Abmessungen
  hoehe_mm: number;
  breite_mm: number;
  tiefe_mm: number;
  gewicht_kg: number;

  // FÃ¶rderung
  bafa_foerderbar: boolean;
  energielabel: 'A+++' | 'A++' | 'A+' | 'A' | 'B' | 'C' | 'D';

  // Preise
  preis_uvp?: number;
  preis_strasse?: number;

  // Dokumentation
  datenblatt_url: string;
  montageanleitung_url?: string;
}

// API fÃ¼r Produktsuche
async function sucheProdukte(
  kategorie: string,
  filter: ProduktFilter
): Promise<Produkt[]> {
  const query = buildQuery(kategorie, filter);
  return await produktDb.search(query);
}

interface ProduktFilter {
  hersteller?: string[];
  U_max?: number;
  lambda_max?: number;
  P_min?: number;
  P_max?: number;
  foerderbar?: boolean;
  preis_max?: number;
  nur_mit_preis?: boolean;
}
```

---

## 8. Schnittstellen zu BehÃ¶rden

### BAFA-Schnittstelle

```typescript
interface BAFASchnittstelle {
  // Antragstellung
  antrag: {
    erstellen: (daten: BAFAAntrag) => Promise<string>;  // Antragsnummer
    status: (antragsnummer: string) => Promise<BAFAStatus>;
    verwendungsnachweis: (antragsnummer: string, nachweis: Nachweis) => Promise<void>;
  };

  // Energieberater-Registrierung
  dena: {
    abfrage: (plz: string) => Promise<Energieberater[]>;
    verifizierung: (berater_id: string) => Promise<boolean>;
  };
}

interface BAFAAntrag {
  antragsteller: {
    name: string;
    adresse: Adresse;
    geburtsdatum?: string;
    steuernummer?: string;
  };

  vorhaben: {
    typ: BAFAMassnahmenTyp;
    beschreibung: string;
    beginn_geplant: string;
    ende_geplant: string;
  };

  gebaeude: {
    adresse: Adresse;
    baujahr: number;
    typ: string;
    wohneinheiten: number;
  };

  kosten: {
    gesamt_brutto: number;
    gesamt_netto: number;
    foerderfaehig: number;
  };

  energieberater: {
    dena_id: string;
    name: string;
  };

  dokumente: {
    kostenvoranschlaege: File[];
    energieberatungsbericht?: File;
    liegenschaftsnachweis: File;
  };
}

// Automatischer Export fÃ¼r BAFA-Portal
async function exportiereFuerBAFA(
  projekt: Projekt,
  massnahmen: Massnahme[]
): Promise<BAFAExportPaket> {
  const antrag = erstelleAntragsdaten(projekt, massnahmen);
  const dokumente = sammleErforderlicheDokumente(projekt);

  // Validierung gegen BAFA-Anforderungen
  const validierung = validiereBAFAAnforderungen(antrag);

  if (!validierung.gueltig) {
    throw new Error(`BAFA-Anforderungen nicht erfÃ¼llt: ${validierung.fehler.join(', ')}`);
  }

  return {
    antrag,
    dokumente,
    checkliste: erstelleCheckliste(antrag),
    hinweise: generiereBAFAHinweise(antrag)
  };
}
```

### DIBt-Schnittstelle (Energieausweis-Registrierung)

```typescript
interface DIBtSchnittstelle {
  // Energieausweis registrieren
  registrieren: (
    ausweis: Energieausweis,
    aussteller: Aussteller
  ) => Promise<{
    registriernummer: string;
    gueltig_bis: string;
  }>;

  // Registriernummer validieren
  validieren: (registriernummer: string) => Promise<{
    gueltig: boolean;
    ausweis_typ: string;
    ausstellungsdatum: string;
  }>;
}

async function registriereEnergieausweis(
  energieausweis: Energieausweis
): Promise<string> {
  // 1. VollstÃ¤ndigkeit prÃ¼fen
  const vollstaendig = pruefeVollstaendigkeit(energieausweis);
  if (!vollstaendig.ok) {
    throw new Error(`Energieausweis unvollstÃ¤ndig: ${vollstaendig.fehlend.join(', ')}`);
  }

  // 2. Beim DIBt registrieren
  const registrierung = await dibt.registrieren(energieausweis, {
    aussteller_id: energieausweis.aussteller.dena_id,
    gebaeude_adresse: energieausweis.gebaeude.adresse,
    ausweis_typ: energieausweis.typ
  });

  // 3. Registriernummer im Ausweis speichern
  energieausweis.registriernummer = registrierung.registriernummer;
  energieausweis.gueltig_bis = registrierung.gueltig_bis;

  return registrierung.registriernummer;
}
```

---

## 9. Mobile App (PWA-Erweiterung)

### Offline-Funktionen

```typescript
interface MobileFeatures {
  // Vor-Ort-Erfassung
  erfassung: {
    foto_mit_metadaten: boolean;      // GPS, Kompass, Datum
    sprachnotizen: boolean;
    schnellerfassung: boolean;        // Vordefinierte Templates
    offline_sync: boolean;
  };

  // Kamera-Features
  kamera: {
    bauteil_erkennung: boolean;
    mass_schaetzung: boolean;         // AR-basiert
    thermografie: boolean;            // Mit ZusatzgerÃ¤t
  };

  // Sync
  synchronisation: {
    automatisch: boolean;
    manuell: boolean;
    konfliktloesung: 'server' | 'lokal' | 'manuell';
  };
}

// Service Worker fÃ¼r Offline-Betrieb
const OFFLINE_CACHE = {
  // Statische Assets
  static: [
    '/app/shell.html',
    '/app/main.js',
    '/app/styles.css',
    '/app/icons/*'
  ],

  // Datenbank fÃ¼r Offline-Daten
  indexedDB: {
    projekte: 'projekte_offline',
    bilder: 'bilder_offline',
    berechnungen: 'berechnungen_cache'
  },

  // Materialdatenbank cachen
  materialdb: {
    version: '2024.1',
    groesse_mb: 15
  }
};

// Synchronisation bei Verbindungsherstellung
async function synchronisiereOfflineDaten(): Promise<SyncErgebnis> {
  const pendingChanges = await db.getPendingChanges();

  const ergebnisse: SyncErgebnis = {
    hochgeladen: 0,
    konflikte: [],
    fehler: []
  };

  for (const change of pendingChanges) {
    try {
      if (change.typ === 'create') {
        await api.create(change.entity, change.data);
      } else if (change.typ === 'update') {
        const serverVersion = await api.getVersion(change.entity, change.id);

        if (serverVersion > change.basis_version) {
          // Konflikt!
          ergebnisse.konflikte.push({
            entity: change.entity,
            id: change.id,
            lokal: change.data,
            server: await api.get(change.entity, change.id)
          });
        } else {
          await api.update(change.entity, change.id, change.data);
        }
      }

      ergebnisse.hochgeladen++;
      await db.markSynced(change.id);
    } catch (error) {
      ergebnisse.fehler.push({
        change,
        error: error.message
      });
    }
  }

  return ergebnisse;
}
```

---

## 10. White-Label-LÃ¶sung

### Konfigurierbare Elemente

```typescript
interface WhiteLabelConfig {
  // Branding
  branding: {
    firmenname: string;
    logo_url: string;
    favicon_url: string;
    primary_color: string;
    secondary_color: string;
    schriftart?: string;
  };

  // Domain
  domain: {
    custom_domain: string;            // z.B. "portal.ihre-firma.de"
    ssl_zertifikat: 'managed' | 'custom';
  };

  // Features
  features: {
    modul_energieausweis: boolean;
    modul_isfp: boolean;
    modul_heizlast: boolean;
    modul_ki: boolean;
    marktplatz: boolean;
    api_zugang: boolean;
  };

  // E-Mail
  email: {
    absender_name: string;
    absender_email: string;
    reply_to: string;
    smtp_custom?: SMTPConfig;
  };

  // Dokumente
  dokumente: {
    briefkopf_template?: string;
    fusszeile_template?: string;
    eigene_agb_url?: string;
    eigene_datenschutz_url?: string;
  };

  // Preise (fÃ¼r Reseller)
  preise: {
    eigene_preise: boolean;
    aufschlag_prozent?: number;
    eigene_plaene?: PreisPlan[];
  };
}

// White-Label Deployment
interface WhiteLabelDeployment {
  tenant_id: string;
  config: WhiteLabelConfig;
  status: 'aktiv' | 'einrichtung' | 'pausiert';

  // DNS-Konfiguration
  dns: {
    cname_ziel: string;              // z.B. "tenant123.energieberaterpro.de"
    ssl_status: 'pending' | 'issued' | 'error';
  };

  // Isolierung
  daten_isolierung: 'shared' | 'dedicated';
  backup_retention_tage: number;
}
```

---

## Priorisierungs-Matrix

| Erweiterung | Aufwand | Impact | Umsatz | PrioritÃ¤t |
|-------------|---------|--------|--------|-----------|
| KI-Assistent | Hoch | Sehr hoch | Hoch | 1 |
| FÃ¶rderungsoptimierung | Mittel | Sehr hoch | Mittel | 2 |
| OCR Dokumentenerkennung | Mittel | Hoch | Mittel | 3 |
| Mobile App (PWA) | Mittel | Hoch | Mittel | 4 |
| Thermografie | Mittel | Mittel | Mittel | 5 |
| Handwerker-Marktplatz | Hoch | Hoch | Hoch | 6 |
| CAD/BIM-Import | Hoch | Mittel | Niedrig | 7 |
| Produkt-Datenbank | Hoch | Mittel | Mittel | 8 |
| BAFA-Schnittstelle | Mittel | Mittel | Niedrig | 9 |
| White-Label | Hoch | Niedrig | Hoch | 10 |

---

## Technische Voraussetzungen

### Infrastruktur-Anforderungen

```yaml
# Erweiterungen benÃ¶tigen zusÃ¤tzliche Services

ki_assistent:
  - claude_api_key
  - gpu_server: optional    # FÃ¼r lokale Modelle
  - embedding_db: pgvector  # FÃ¼r RAG

ocr:
  - tesseract: 5.x
  - vision_api: google | azure | aws
  - storage: s3_compatible

thermografie:
  - flir_sdk: optional
  - image_processing: sharp | jimp

cad_import:
  - ifc_parser: ifc.js | xeokit
  - dxf_parser: dxf-parser
  - pdf_renderer: pdf.js

marktplatz:
  - payment_gateway: stripe | mollie
  - messaging: websocket
  - search: elasticsearch | meilisearch

whitelabel:
  - wildcard_ssl: letsencrypt
  - cdn: cloudflare | fastly
  - multi_tenant_db: dedicated | shared
```

---

## Fazit

Die geplanten Erweiterungen bauen auf dem Kern-System auf und erweitern EnergieberaterPRO zu einer umfassenden Plattform fÃ¼r alle Aspekte der Energieberatung. Die Priorisierung fokussiert zunÃ¤chst auf Features mit hohem Kundennutzen (KI, FÃ¶rderung) und baut dann das Ã–kosystem aus (Marktplatz, Hersteller).
